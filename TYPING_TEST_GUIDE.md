# 타이핑 인디케이터 테스트 가이드

## 🎯 테스트 준비

### 1. 서버 실행 확인
```bash
# 서버가 실행 중인지 확인
curl http://localhost:8080/actuator/health
```

### 2. 브라우저에서 테스트 페이지 열기
```
http://localhost:8080/chat-test.html
```

---

## 🧪 테스트 시나리오

### 시나리오 1: 기본 타이핑 인디케이터 테스트

#### 브라우저 탭 1 (매장)
1. **로그인**
   - 사용자 타입: `매장 (store1)` 선택
   - Username: `store1`
   - Password: `password123`
   - "로그인" 버튼 클릭

2. **채팅방 생성**
   - 매장 ID: `store1`
   - 유통업체 ID: `dist1`
   - "채팅방 생성/조회" 버튼 클릭

3. **WebSocket 연결**
   - "연결" 버튼 클릭
   - "✅ 연결됨" 표시 확인

#### 브라우저 탭 2 (유통업체)
1. **로그인**
   - 사용자 타입: `유통업체 (dist1)` 선택
   - Username: `dist1`
   - Password: `password123`
   - "로그인" 버튼 클릭

2. **채팅방 조회**
   - 매장 ID: `store1`
   - 유통업체 ID: `dist1`
   - "채팅방 생성/조회" 버튼 클릭
   - (같은 채팅방이 조회됨)

3. **WebSocket 연결**
   - "연결" 버튼 클릭
   - "✅ 연결됨" 표시 확인

#### 타이핑 테스트
1. **탭 1 (매장)**에서 메시지 입력란에 타이핑 시작
   - 텍스트를 입력하기 시작

2. **탭 2 (유통업체)**에서 확인
   - 메시지 영역 아래에 녹색 박스로 표시됨:
   - "**김밥천국 강남점**님이 입력 중..."
   - 점 3개가 깜빡이는 애니메이션

3. **탭 1 (매장)**에서 입력 중단
   - 2초간 입력하지 않으면 자동으로 중단

4. **탭 2 (유통업체)**에서 확인
   - 타이핑 인디케이터가 사라짐

---

### 시나리오 2: 수동 타이핑 이벤트 테스트

#### 탭 1 (매장)
1. "5. 타이핑 인디케이터 테스트" 섹션으로 이동
2. "수동: 입력 시작" 버튼 클릭

#### 탭 2 (유통업체)
- 타이핑 인디케이터 표시 확인

#### 탭 1 (매장)
3. "수동: 입력 중단" 버튼 클릭

#### 탭 2 (유통업체)
- 타이핑 인디케이터 사라짐 확인

---

### 시나리오 3: 메시지 전송 시 타이핑 중단

#### 탭 1 (매장)
1. 메시지 입력란에 타이핑 시작
2. 탭 2에서 타이핑 인디케이터 확인
3. 메시지 입력 완료 후 "전송" 버튼 클릭

#### 탭 2 (유통업체)
- 타이핑 인디케이터가 즉시 사라짐
- 메시지가 표시됨

---

### 시나리오 4: 양방향 타이핑

#### 탭 1 (매장)
1. 메시지 입력란에 타이핑 시작

#### 탭 2 (유통업체)
2. 동시에 메시지 입력란에 타이핑 시작

#### 결과
- 각 탭에서 상대방의 타이핑 인디케이터만 표시됨
- 자신의 타이핑은 표시되지 않음

---

## ✅ 확인 사항

### UI 확인
- [ ] 타이핑 인디케이터가 녹색 박스로 표시됨
- [ ] 사용자 이름이 올바르게 표시됨
- [ ] 점 3개가 깜빡이는 애니메이션 동작
- [ ] 2초 후 자동으로 사라짐
- [ ] 메시지 전송 시 즉시 사라짐

### 기능 확인
- [ ] 자동 타이핑 감지 동작
- [ ] 수동 버튼으로 타이핑 이벤트 전송 가능
- [ ] 자신의 타이핑은 표시되지 않음
- [ ] 상대방의 타이핑만 표시됨
- [ ] WebSocket 연결 해제 시 타이핑 중단 이벤트 전송

### 콘솔 로그 확인
브라우저 개발자 도구 (F12) → Console 탭에서:
```
✅ WebSocket 연결 성공
✅ 타이핑 인디케이터 구독 완료
📤 타이핑 이벤트 전송: 시작
📥 타이핑 이벤트 수신: {roomId: "...", userId: "...", ...}
📤 타이핑 이벤트 전송: 중단
```

---

## 🐛 문제 해결

### 타이핑 인디케이터가 표시되지 않음
1. 두 브라우저 탭 모두 WebSocket 연결 확인
2. 같은 채팅방에 연결되어 있는지 확인
3. 콘솔에서 에러 메시지 확인

### 자신의 타이핑도 표시됨
- 정상: 자신의 타이핑은 필터링되어 표시되지 않아야 함
- 문제 발생 시 콘솔 로그에서 `currentUserId` 확인

### 타이핑 인디케이터가 사라지지 않음
- 2초 후 자동으로 사라져야 함
- 10초 후에는 강제로 사라짐 (타임아웃)

---

## 📊 성능 테스트

### Rate Limiting 확인
1. 빠르게 타이핑하면서 콘솔 로그 확인
2. 타이핑 이벤트가 너무 자주 전송되지 않는지 확인
3. 현재 구현: 입력 시작 시 1회, 2초 후 자동 중단

### 네트워크 확인
브라우저 개발자 도구 → Network 탭 → WS 필터:
- WebSocket 연결 상태 확인
- 타이핑 이벤트 프레임 확인

---

## 🎨 UI 커스터마이징

타이핑 인디케이터 스타일 변경:
```css
.typing-indicator {
    background-color: #e8f5e9;  /* 배경색 */
    border-left: 4px solid #4CAF50;  /* 왼쪽 테두리 */
    color: #2e7d32;  /* 텍스트 색상 */
}
```

애니메이션 속도 조정:
```css
@keyframes pulse {
    /* 깜빡임 속도 조정 */
}
```

---

## 📝 테스트 체크리스트

### 기본 기능
- [ ] 로그인 성공
- [ ] 채팅방 생성/조회 성공
- [ ] WebSocket 연결 성공
- [ ] 타이핑 인디케이터 구독 성공

### 타이핑 인디케이터
- [ ] 자동 타이핑 감지 동작
- [ ] 수동 버튼 동작
- [ ] 2초 후 자동 중단
- [ ] 메시지 전송 시 중단
- [ ] 자신의 타이핑 필터링
- [ ] 사용자 이름 표시
- [ ] 애니메이션 동작

### 엣지 케이스
- [ ] 빠른 타이핑 처리
- [ ] 연결 해제 시 타이핑 중단
- [ ] 여러 사용자 동시 타이핑
- [ ] 네트워크 끊김 후 재연결

---

## 🚀 다음 단계

테스트 완료 후:
1. Flutter 팀에 테스트 결과 공유
2. 필요 시 UI/UX 개선 논의
3. 프로덕션 배포 준비

---

**테스트 완료 시간**: 약 10분  
**권장 브라우저**: Chrome, Firefox, Safari
