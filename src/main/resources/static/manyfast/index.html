<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manyfast Editor MVP</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #1a1a1a; color: #e2e8f0; }
        .app { display: flex; height: 100vh; }
        
        .chat-panel { width: 340px; background: linear-gradient(180deg, #1a1625 0%, #1e293b 100%); display: flex; flex-direction: column; border-right: 1px solid #2d2640; }
        .chat-header { padding: 20px; border-bottom: 1px solid #2d2640; background: rgba(139, 92, 246, 0.03); }
        .chat-header h2 { font-size: 11px; color: #8b5cf6; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        .project-select { width: 100%; padding: 10px 14px; background: #2d2640; border: 1px solid #3d3455; border-radius: 10px; color: white; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .project-select:hover { border-color: #8b5cf6; }
        .project-select:focus { outline: none; border-color: #8b5cf6; box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1); }
        .new-project-btn { width: 100%; margin-top: 10px; padding: 10px; background: transparent; border: 1px dashed #3d3455; border-radius: 10px; color: #6b7280; cursor: pointer; font-size: 13px; transition: all 0.2s; }
        .new-project-btn:hover { border-color: #8b5cf6; color: #8b5cf6; background: rgba(139, 92, 246, 0.05); }
        .chat-messages { flex: 1; overflow-y: auto; padding: 16px; scroll-behavior: smooth; }
        .chat-messages::-webkit-scrollbar { width: 4px; }
        .chat-messages::-webkit-scrollbar-track { background: transparent; }
        .chat-messages::-webkit-scrollbar-thumb { background: #3d3455; border-radius: 4px; }
        .message { margin-bottom: 16px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .message.user { display: flex; justify-content: flex-end; }
        .message-bubble { display: inline-block; max-width: 85%; padding: 12px 16px; border-radius: 16px; font-size: 13px; line-height: 1.6; }
        .message.user .message-bubble { background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); border-radius: 16px 16px 4px 16px; box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3); }
        .message.ai .message-bubble { background: transparent; padding: 0; max-width: 100%; }
        .typing { color: #64748b; font-size: 12px; padding: 8px; }
        
        /* AI ÏùëÎãµ Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .ai-response { background: linear-gradient(135deg, #1e1b2e 0%, #252040 100%); border-radius: 16px; overflow: hidden; border: 1px solid #2d2640; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); }
        .ai-response-header { padding: 14px 16px; border-bottom: 1px solid #2d2640; display: flex; align-items: center; gap: 10px; background: rgba(139, 92, 246, 0.05); }
        .ai-response-header .icon { width: 24px; height: 24px; background: linear-gradient(135deg, #8b5cf6, #6366f1); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .ai-response-header .title { font-weight: 600; font-size: 13px; color: #e2e8f0; }
        .ai-response-body { padding: 14px 16px; }
        .ai-step { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; border-bottom: 1px solid rgba(139, 92, 246, 0.1); }
        .ai-step:last-child { border-bottom: none; }
        .ai-step-icon { width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; margin-top: 2px; }
        .ai-step-icon.thinking { background: #2d2640; color: #94a3b8; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .ai-step-icon.done { background: rgba(52, 211, 153, 0.15); color: #34d399; }
        .ai-step-icon.feature { background: rgba(139, 92, 246, 0.15); color: #a78bfa; }
        .ai-step-content { flex: 1; }
        .ai-step-title { font-size: 13px; font-weight: 600; margin-bottom: 3px; color: #f1f5f9; }
        .ai-step-desc { font-size: 12px; color: #94a3b8; }
        .ai-summary { background: rgba(15, 23, 42, 0.5); padding: 12px 14px; border-radius: 10px; margin-top: 10px; font-size: 12px; color: #94a3b8; line-height: 1.6; border: 1px solid #2d2640; }
        .chat-input-area { padding: 16px; border-top: 1px solid #2d2640; background: rgba(139, 92, 246, 0.02); }
        .chat-input-wrapper { display: flex; align-items: flex-end; gap: 10px; background: #2d2640; border-radius: 14px; padding: 4px; border: 1px solid #3d3455; transition: all 0.2s; }
        .chat-input-wrapper:focus-within { border-color: #8b5cf6; box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1); }
        .chat-input { flex: 1; padding: 10px 12px; background: transparent; border: none; color: white; resize: none; font-size: 13px; line-height: 1.5; max-height: 100px; }
        .chat-input:focus { outline: none; }
        .chat-input::placeholder { color: #6b7280; }
        .chat-send-btn { padding: 8px 14px; background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); border: none; border-radius: 10px; color: white; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s; }
        .chat-send-btn:hover { transform: scale(1.02); box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4); }
        .chat-send-btn:active { transform: scale(0.98); }
        
        .main-area { flex: 1; display: flex; flex-direction: column; background: #1a1a1a; }
        .toolbar { padding: 10px 16px; background: rgba(139, 92, 246, 0.03); border-bottom: 1px solid #2d2640; display: flex; align-items: center; gap: 8px; }
        .toolbar h1 { font-size: 16px; font-weight: 500; margin-right: 20px; }
        .tab-btn { padding: 6px 14px; background: transparent; border: 1px solid #2d2640; border-radius: 6px; color: #94a3b8; cursor: pointer; font-size: 13px; }
        .tab-btn:hover { border-color: #8b5cf6; color: #e2e8f0; }
        .tab-btn.active { background: rgba(139, 92, 246, 0.15); border-color: #8b5cf6; color: white; }
        .export-btn { margin-left: auto; padding: 6px 14px; background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); border: none; border-radius: 6px; color: white; cursor: pointer; }
        
        .fs-container { flex: 1; overflow: auto; padding: 60px; background: #1a1a1a; position: relative; }
        
        /* ÎßàÏù∏ÎìúÎßµ Î†àÏù¥ÏïÑÏõÉ - manyfast.io Ïä§ÌÉÄÏùº */
        .mindmap { 
            position: relative; 
            display: flex; 
            align-items: center; 
            gap: 0; 
            min-height: 600px;
        }
        .mindmap-svg { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            pointer-events: none; 
            z-index: 0;
        }
        .node-column { display: flex; flex-direction: column; gap: 30px; position: relative; z-index: 1; }
        
        /* ÎÖ∏Îìú Ïπ¥Îìú - manyfast.io Ïä§ÌÉÄÏùº */
        .node-card { 
            background: #2a2a2a; 
            border: 1px solid #3a3a3a; 
            border-radius: 8px; 
            padding: 16px 18px; 
            min-width: 260px; 
            max-width: 340px; 
            position: relative; 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }
        .node-card:hover { 
            border-color: #4a4a4a; 
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        }
        .node-card.root { 
            background: #2a2a2a; 
            border: 1px solid #3a3a3a;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        .node-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .node-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #888;
        }
        .node-title { 
            font-size: 14px; 
            font-weight: 600; 
            color: #e8e8e8;
            line-height: 1.4;
            flex: 1;
        }
        .node-desc { 
            font-size: 11px; 
            color: #888; 
            line-height: 1.5; 
            margin-bottom: 12px; 
        }
        .node-meta { 
            display: flex; 
            gap: 8px; 
            flex-wrap: wrap; 
            align-items: center;
        }
        .badge { 
            font-size: 10px; 
            padding: 4px 10px; 
            border-radius: 4px; 
            font-weight: 500;
            letter-spacing: 0.3px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .badge.todo { 
            background: rgba(59, 130, 246, 0.15); 
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .badge.admin { 
            background: rgba(139, 92, 246, 0.15); 
            color: #a78bfa;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        .prd-link { 
            font-size: 11px; 
            color: #60a5fa; 
            cursor: pointer; 
            font-weight: 500;
            transition: color 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .prd-link:hover {
            color: #93c5fd;
        }
        
        /* Ïó∞Í≤∞ÏÑ† - Í∞ÄÎ°ú */
        .h-connector { 
            width: 60px; 
            height: 2px; 
            background: linear-gradient(90deg, rgba(100, 116, 139, 0.4) 0%, rgba(139, 92, 246, 0.3) 100%); 
            align-self: center; 
        }
        
        /* Ïó∞Í≤∞ÏÑ† - ÏÑ∏Î°ú Î∏åÎûúÏπò */
        .branch-container { display: flex; align-items: stretch; }
        .v-branch { width: 50px; position: relative; display: flex; flex-direction: column; justify-content: center; }
        .v-branch::before { content: ''; position: absolute; left: 0; top: 50%; width: 100%; height: 2px; background: #475569; }
        .v-branch-line { position: absolute; left: 0; width: 2px; background: #475569; }
        
        /* Î∏åÎûúÏπò ÏïÑÏù¥ÌÖú */
        .branch-item { display: flex; align-items: center; position: relative; }
        .branch-connector { width: 50px; height: 2px; background: #475569; }
        
        /* Î™®Îã¨ */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; z-index: 100; animation: modalFadeIn 0.2s ease; }
        @keyframes modalFadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { background: linear-gradient(180deg, #1e1b2e 0%, #1a1625 100%); padding: 0; border-radius: 16px; width: 480px; max-height: 80vh; overflow-y: auto; border: 1px solid #2d2640; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(139, 92, 246, 0.1); animation: modalSlideIn 0.3s ease; }
        @keyframes modalSlideIn { from { opacity: 0; transform: scale(0.95) translateY(-10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-content h2 { font-size: 18px; font-weight: 600; color: #f1f5f9; padding: 24px 24px 0 24px; margin-bottom: 20px; }
        .modal-form { padding: 0 24px 24px 24px; }
        .modal-field { margin-bottom: 16px; }
        .modal-field label { display: block; font-size: 12px; font-weight: 500; color: #94a3b8; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .modal-content input, .modal-content textarea { width: 100%; padding: 12px 14px; background: rgba(45, 38, 64, 0.5); border: 1px solid #3d3455; border-radius: 10px; color: #f1f5f9; font-size: 14px; transition: all 0.2s; margin-bottom: 0; }
        .modal-content input:focus, .modal-content textarea:focus { outline: none; border-color: #8b5cf6; box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15); background: rgba(45, 38, 64, 0.8); }
        .modal-content input::placeholder, .modal-content textarea::placeholder { color: #6b7280; }
        .modal-content textarea { resize: none; min-height: 100px; line-height: 1.5; }
        .modal-buttons { display: flex; gap: 10px; padding: 16px 24px; background: rgba(139, 92, 246, 0.03); border-top: 1px solid #2d2640; border-radius: 0 0 16px 16px; }
        .modal-buttons button { padding: 10px 20px; border: none; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; }
        .modal-buttons .primary { background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); color: white; box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3); }
        .modal-buttons .primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4); }
        .modal-buttons .primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .modal-buttons .secondary { background: rgba(45, 38, 64, 0.5); color: #94a3b8; border: 1px solid #3d3455; }
        .modal-buttons .secondary:hover { background: rgba(45, 38, 64, 0.8); color: #e2e8f0; border-color: #4d4465; }
        .prd-content { background: #0f172a; padding: 16px; border-radius: 8px; white-space: pre-wrap; line-height: 1.6; font-size: 13px; }
        
        .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #64748b; }
        .empty-state h3 { color: #94a3b8; margin-bottom: 8px; }
        
        /* IA Î∑∞ Ïä§ÌÉÄÏùº - manyfast.io Ïä§ÌÉÄÏùº */
        .ia-tree { display: flex; flex-direction: column; align-items: center; padding: 40px; }
        .ia-root { display: flex; justify-content: center; }
        .ia-root-card { 
            background: #2a2a2a; 
            border: 1px solid #3a3a3a; 
            border-radius: 8px; 
            padding: 16px 24px; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        .ia-root-card .icon { font-size: 16px; }
        .ia-root-card .title { font-size: 14px; font-weight: 600; color: #e8e8e8; }
        .ia-root-card .prd-link { 
            font-size: 11px; 
            color: #60a5fa; 
            margin-left: 12px; 
            cursor: pointer; 
            font-weight: 500;
        }
        .ia-root-card .prd-link:hover {
            color: #93c5fd;
        }
        
        .ia-vline { width: 2px; height: 40px; background: #475569; }
        
        .ia-branch { display: flex; gap: 24px; position: relative; }
        .ia-branch::before { content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%); height: 2px; background: #475569; }
        .ia-branch-item { display: flex; flex-direction: column; align-items: center; }
        .ia-branch-item:first-child:last-child .ia-branch-vline { display: block; }
        .ia-branch-vline { width: 2px; height: 30px; background: #475569; }
        
        /* Í∞ÄÎ°úÏÑ† ÎÑàÎπÑ ÏûêÎèô Í≥ÑÏÇ∞ */
        .ia-branch::before { width: calc(100% - 280px); }
        .ia-branch:has(.ia-branch-item:only-child)::before { width: 0; }
        
        .ia-page-card { 
            background: #2a2a2a; 
            border: 1px solid #3a3a3a; 
            border-radius: 8px; 
            width: 280px; 
            overflow: hidden; 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }
        .ia-page-card:hover {
            border-color: #4a4a4a;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        }
        .ia-page-header { 
            padding: 12px 14px; 
            border-bottom: 1px solid #3a3a3a; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            background: rgba(255, 255, 255, 0.02);
        }
        .ia-page-header .badge { 
            background: rgba(139, 92, 246, 0.15); 
            color: #a78bfa; 
            font-size: 10px; 
            padding: 3px 7px; 
            border-radius: 4px; 
            font-weight: 600;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        .ia-page-header .title { 
            font-size: 13px; 
            font-weight: 600; 
            flex: 1; 
            color: #e8e8e8;
        }
        .ia-page-header .id { 
            font-size: 10px; 
            color: #666; 
            font-weight: 500;
        }
        .ia-page-desc { 
            padding: 10px 14px; 
            font-size: 11px; 
            color: #888; 
            border-bottom: 1px solid #3a3a3a; 
            line-height: 1.5; 
        }
        .ia-page-features { padding: 10px 14px; }
        .ia-page-features-title { 
            font-size: 10px; 
            color: #666; 
            margin-bottom: 8px; 
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .ia-feature-item { 
            font-size: 11px; 
            padding: 6px 0; 
            border-bottom: 1px solid #3a3a3a; 
            color: #ccc; 
        }
        .ia-feature-item:last-child { border-bottom: none; }
        
        /* IA SVG Ìä∏Î¶¨ Ïä§ÌÉÄÏùº */
        .ia-node-item { min-width: 280px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const API_BASE = '/api/manyfast';

        function App() {
            const [projects, setProjects] = useState([]);
            const [currentProject, setCurrentProject] = useState(null);
            const [treeData, setTreeData] = useState([]);
            const [messages, setMessages] = useState([]);
            const [inputText, setInputText] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [activeTab, setActiveTab] = useState('FS');
            const [showPRD, setShowPRD] = useState(false);
            const [prdContent, setPrdContent] = useState('');
            const [showNewProject, setShowNewProject] = useState(false);
            const messagesEndRef = useRef(null);

            useEffect(() => { loadProjects(); }, []);
            useEffect(() => { 
                if (currentProject) { 
                    loadProjectTree(); 
                    setMessages([{ type: 'ai', text: `"${currentProject.name}" ÌîÑÎ°úÏ†ùÌä∏ÏûÖÎãàÎã§.` }]); 
                } 
            }, [currentProject]);
            useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);

            const loadProjects = async () => {
                const res = await fetch(`${API_BASE}/projects`);
                const data = await res.json();
                setProjects(data);
                if (data.length > 0 && !currentProject) setCurrentProject(data[0]);
            };

            const loadProjectTree = async () => {
                const res = await fetch(`${API_BASE}/projects/${currentProject.projectId}/tree`);
                setTreeData(await res.json());
            };

            const createProject = async (name, desc) => {
                const res = await fetch(`${API_BASE}/projects`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description: desc })
                });
                const project = await res.json();
                setProjects([...projects, project]);
                setCurrentProject(project);
                setShowNewProject(false);
            };

            const handleSendMessage = async () => {
                if (!inputText.trim() || !currentProject) return;
                const userMessage = inputText.trim();
                setMessages(prev => [...prev, { type: 'user', text: userMessage }]);
                setInputText('');
                setIsTyping(true);
                try {
                    const res = await fetch(`${API_BASE}/projects/${currentProject.projectId}/chat`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: userMessage })
                    });
                    const data = await res.json();
                    setMessages(prev => [...prev, { type: 'ai', text: data.response }]);
                    if (data.nodesCreated > 0) loadProjectTree();
                } catch (e) {
                    setMessages(prev => [...prev, { type: 'ai', text: 'Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' }]);
                }
                setIsTyping(false);
            };

            const generatePRD = async () => {
                setIsTyping(true);
                const res = await fetch(`${API_BASE}/projects/${currentProject.projectId}/generate-prd`, { method: 'POST' });
                const data = await res.json();
                setPrdContent(data.prd);
                setShowPRD(true);
                setIsTyping(false);
            };

            return (
                <div className="app">
                    <div className="chat-panel">
                        <div className="chat-header">
                            <h2>New chat</h2>
                            <select className="project-select" value={currentProject?.id || ''} 
                                onChange={e => setCurrentProject(projects.find(p => p.id === parseInt(e.target.value)))}>
                                {projects.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}
                            </select>
                            <button className="new-project-btn" onClick={() => setShowNewProject(true)}>+ ÏÉà ÌîÑÎ°úÏ†ùÌä∏</button>
                        </div>
                        <div className="chat-messages">
                            {messages.map((msg, i) => (
                                <div key={i} className={`message ${msg.type}`}>
                                    {msg.type === 'user' ? (
                                        <div className="message-bubble">{msg.text}</div>
                                    ) : (
                                        <AIResponseCard text={msg.text} />
                                    )}
                                </div>
                            ))}
                            {isTyping && (
                                <div className="ai-response" style={{margin: '8px 0'}}>
                                    <div className="ai-response-body">
                                        <div className="ai-step">
                                            <div className="ai-step-icon thinking">‚è≥</div>
                                            <div className="ai-step-content">
                                                <div className="ai-step-title">ÏÉùÍ∞ÅÌï®</div>
                                                <div className="ai-step-desc">Í∏∞Îä•ÏùÑ Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>
                        <div className="chat-input-area">
                            <div className="chat-input-wrapper">
                                <textarea className="chat-input" placeholder="Í∏∞Îä•ÏùÑ ÏöîÏ≤≠Ìï¥Î≥¥ÏÑ∏Ïöî..."
                                    value={inputText} onChange={e => setInputText(e.target.value)}
                                    onKeyPress={e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSendMessage(); }}}
                                    rows="1" />
                                <button className="chat-send-btn" onClick={handleSendMessage}>Ï†ÑÏÜ°</button>
                            </div>
                        </div>
                    </div>
                    
                    <div className="main-area">
                        <div className="toolbar">
                            <h1>{currentProject?.name || 'Manyfast'}</h1>
                            {['PRD', 'FS', 'IA', 'Tree', 'Directory'].map(tab => (
                                <button key={tab} className={`tab-btn ${activeTab === tab ? 'active' : ''}`}
                                    onClick={() => setActiveTab(tab)}>{tab}</button>
                            ))}
                            <button className="export-btn" onClick={generatePRD}>Export</button>
                        </div>
                        <div className="fs-container">
                            {activeTab === 'FS' && <MindmapView treeData={treeData} projectName={currentProject?.name} onPRDClick={() => setShowPRD(true)} />}
                            {activeTab === 'PRD' && <PRDView content={prdContent} onGenerate={generatePRD} />}
                            {activeTab === 'IA' && <IAView treeData={treeData} projectName={currentProject?.name} onPRDClick={() => setShowPRD(true)} />}
                            {activeTab === 'Tree' && <TreeView treeData={treeData} />}
                            {activeTab === 'Directory' && <div className="empty-state"><h3>Directory Î∑∞ Ï§ÄÎπÑ Ï§ë</h3></div>}
                        </div>
                    </div>
                    {showNewProject && <NewProjectModal onClose={() => setShowNewProject(false)} onCreate={createProject} />}
                    {showPRD && <PRDModal content={prdContent} onClose={() => setShowPRD(false)} />}
                </div>
            );
        }

        // ÎßàÏù∏ÎìúÎßµ Î∑∞ - manyfast.io Ïä§ÌÉÄÏùº Í≥°ÏÑ† Ïó∞Í≤∞ÏÑ†
        function MindmapView({ treeData, projectName, onPRDClick }) {
            const containerRef = useRef(null);
            const [connections, setConnections] = useState([]);
            
            useEffect(() => {
                if (containerRef.current) {
                    const updateConnections = () => {
                        const newConnections = [];
                        const cards = containerRef.current.querySelectorAll('.node-card');
                        
                        cards.forEach((card, idx) => {
                            const parentId = card.getAttribute('data-parent-id');
                            if (parentId) {
                                const parentCard = containerRef.current.querySelector(`[data-node-id="${parentId}"]`);
                                if (parentCard) {
                                    const parentRect = parentCard.getBoundingClientRect();
                                    const cardRect = card.getBoundingClientRect();
                                    const containerRect = containerRef.current.getBoundingClientRect();
                                    
                                    const x1 = parentRect.right - containerRect.left;
                                    const y1 = parentRect.top + parentRect.height / 2 - containerRect.top;
                                    const x2 = cardRect.left - containerRect.left;
                                    const y2 = cardRect.top + cardRect.height / 2 - containerRect.top;
                                    
                                    const cx = (x1 + x2) / 2;
                                    
                                    newConnections.push({
                                        id: `${parentId}-${card.getAttribute('data-node-id')}`,
                                        path: `M ${x1} ${y1} C ${cx} ${y1}, ${cx} ${y2}, ${x2} ${y2}`
                                    });
                                }
                            }
                        });
                        
                        setConnections(newConnections);
                    };
                    
                    updateConnections();
                    window.addEventListener('resize', updateConnections);
                    return () => window.removeEventListener('resize', updateConnections);
                }
            }, [treeData]);
            
            if (!treeData || treeData.length === 0) {
                return <div className="empty-state"><h3>Í∏∞Îä•ÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî</h3><p>Ï±ÑÌåÖÏ∞ΩÏóêÏÑú Í∏∞Îä•ÏùÑ ÏöîÏ≤≠Ìï¥Î≥¥ÏÑ∏Ïöî</p></div>;
            }
            
            return (
                <div ref={containerRef} className="mindmap" style={{position: 'relative'}}>
                    <svg className="mindmap-svg" style={{position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', pointerEvents: 'none'}}>
                        {connections.map(conn => (
                            <path key={conn.id} d={conn.path} stroke="rgba(100, 116, 139, 0.3)" strokeWidth="1.5" fill="none" />
                        ))}
                    </svg>
                    
                    <div className="node-card root" data-node-id="root" style={{zIndex: 1, position: 'relative'}}>
                        <div className="node-header">
                            <span className="node-icon">üìÑ</span>
                            <div className="node-title">{projectName || 'Project'}</div>
                        </div>
                        <span className="prd-link" onClick={onPRDClick}>‚Üó PRD</span>
                    </div>
                    
                    <div style={{width: '80px'}}></div>
                    
                    <NodeColumn nodes={treeData} parentId="root" />
                </div>
            );
        }
        
        function NodeColumn({ nodes, parentId }) {
            if (!nodes || nodes.length === 0) return null;
            
            return (
                <div style={{display: 'flex', flexDirection: 'column', gap: '30px', position: 'relative', zIndex: 1}}>
                    {nodes.map((node) => (
                        <div key={node.id} style={{display: 'flex', alignItems: 'center', gap: 0}}>
                            <div className="node-card" data-node-id={node.id} data-parent-id={parentId}>
                                <div className="node-header">
                                    <span className="node-icon">üìä</span>
                                    <div className="node-title">{node.title}</div>
                                </div>
                                {node.description && <div className="node-desc">{node.description.substring(0, 60)}...</div>}
                                <div className="node-meta">
                                    <span className="badge todo">‚Üó To Do</span>
                                    {node.nodeType === 'FEATURE' && <span className="badge admin">Admin</span>}
                                </div>
                            </div>
                            
                            {node.children && node.children.length > 0 && (
                                <>
                                    <div style={{width: '80px'}}></div>
                                    <NodeColumn nodes={node.children} parentId={node.id} />
                                </>
                            )}
                        </div>
                    ))}
                </div>
            );
        }
        
        function NodeBranch({ nodes, level }) {
            const containerRef = useRef(null);
            const [nodePositions, setNodePositions] = useState([]);
            
            useEffect(() => {
                if (containerRef.current) {
                    const nodeElements = containerRef.current.querySelectorAll(':scope > .node-row');
                    const positions = Array.from(nodeElements).map(el => {
                        const rect = el.getBoundingClientRect();
                        const containerRect = containerRef.current.getBoundingClientRect();
                        return {
                            top: rect.top - containerRect.top,
                            height: rect.height,
                            center: rect.top - containerRect.top + rect.height / 2
                        };
                    });
                    setNodePositions(positions);
                }
            }, [nodes]);
            
            if (!nodes || nodes.length === 0) return null;
            
            const totalHeight = nodePositions.length > 0 
                ? nodePositions[nodePositions.length - 1].top + nodePositions[nodePositions.length - 1].height
                : nodes.length * 100;
            
            const firstCenter = nodePositions[0]?.center || 50;
            const lastCenter = nodePositions[nodePositions.length - 1]?.center || totalHeight - 50;
            const midY = totalHeight / 2;
            
            return (
                <div style={{display: 'flex', alignItems: 'stretch'}}>
                    {/* Ïó∞Í≤∞ÏÑ† SVG */}
                    <svg width="50" height={totalHeight} style={{flexShrink: 0, minHeight: totalHeight}}>
                        {/* ÏûÖÎ†•ÏÑ† (ÏôºÏ™Ω ‚Üí Ï§ëÏïô) */}
                        <line x1="0" y1={midY} x2="25" y2={midY} stroke="#475569" strokeWidth="2"/>
                        
                        {nodes.length > 1 && nodePositions.length > 1 ? (
                            <>
                                {/* ÏÑ∏Î°úÏÑ† */}
                                <line x1="25" y1={firstCenter} x2="25" y2={lastCenter} stroke="#475569" strokeWidth="2"/>
                                {/* Í∞Å ÎÖ∏ÎìúÎ°ú Í∞ÄÎäî Í∞ÄÎ°úÏÑ† */}
                                {nodePositions.map((pos, idx) => (
                                    <line key={idx} x1="25" y1={pos.center} x2="50" y2={pos.center} stroke="#475569" strokeWidth="2"/>
                                ))}
                            </>
                        ) : (
                            <line x1="25" y1={midY} x2="50" y2={midY} stroke="#475569" strokeWidth="2"/>
                        )}
                    </svg>
                    
                    {/* ÎÖ∏Îìú Ïª¨Îüº */}
                    <div ref={containerRef} style={{display: 'flex', flexDirection: 'column', gap: '16px'}}>
                        {nodes.map((node) => (
                            <div key={node.id} className="node-row" style={{display: 'flex', alignItems: 'center'}}>
                                <div className="node-card">
                                    <div className="node-title">{node.title}</div>
                                    {node.description && <div className="node-desc">{node.description.substring(0, 50)}...</div>}
                                    <div className="node-meta">
                                        <span className="badge todo">To Do</span>
                                        {node.nodeType === 'FEATURE' && <span className="badge admin">Admin</span>}
                                    </div>
                                </div>
                                
                                {node.children && node.children.length > 0 && (
                                    <NodeBranch nodes={node.children} level={level + 1} />
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // AI ÏùëÎãµÏùÑ ÌååÏã±Ìï¥ÏÑú Ïπ¥ÎìúÎ°ú ÌëúÏãú
        function AIResponseCard({ text }) {
            const parseResponse = (text) => {
                const steps = [];
                const lines = text.split('\n');
                
                // "NÍ∞úÏùò Í∏∞Îä•Ïù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§" Ìå®ÌÑ¥ Ï∞æÍ∏∞
                const countMatch = text.match(/(\d+)Í∞úÏùò Í∏∞Îä•Ïù¥ Ï∂îÍ∞Ä/);
                if (countMatch) {
                    steps.push({ type: 'done', title: 'Feature completed', desc: `${countMatch[1]}Í∞úÏùò Í∏∞Îä•Ïù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§` });
                }
                
                // [NODE] Î∏îÎ°ù ÌååÏã±
                const nodeMatches = text.matchAll(/\[NODE\]([\s\S]*?)\[\/NODE\]/gi);
                for (const match of nodeMatches) {
                    const block = match[1];
                    const titleMatch = block.match(/title:\s*(.+)/i);
                    const typeMatch = block.match(/type:\s*(.+)/i);
                    const descMatch = block.match(/description:\s*(.+)/i);
                    
                    if (titleMatch) {
                        steps.push({
                            type: 'feature',
                            title: titleMatch[1].trim(),
                            desc: typeMatch ? typeMatch[1].trim() : 'FEATURE',
                            fullDesc: descMatch ? descMatch[1].trim() : ''
                        });
                    }
                }
                
                // [FEATURE], [TASK] Îì± Ìå®ÌÑ¥
                const altMatches = text.matchAll(/\[(FEATURE|TASK|REQUIREMENT)\]\s*([^\n]+)/gi);
                for (const match of altMatches) {
                    steps.push({
                        type: 'feature',
                        title: match[2].trim().replace(/^title:\s*/i, ''),
                        desc: match[1]
                    });
                }
                
                // ÎÇòÎ®∏ÏßÄ ÏÑ§Î™Ö ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú
                let summary = text
                    .replace(/\[NODE\][\s\S]*?\[\/NODE\]/gi, '')
                    .replace(/\[(FEATURE|TASK|REQUIREMENT)\][^\n]*/gi, '')
                    .replace(/\d+Í∞úÏùò Í∏∞Îä•Ïù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§\.?/g, '')
                    .replace(/title:.*\n?/gi, '')
                    .replace(/type:.*\n?/gi, '')
                    .replace(/description:.*\n?/gi, '')
                    .replace(/parent:.*\n?/gi, '')
                    .trim();
                
                // Ïó¨Îü¨ Ï§Ñ Í≥µÎ∞± Ï†ïÎ¶¨
                summary = summary.replace(/\n{3,}/g, '\n\n').trim();
                
                return { steps, summary };
            };
            
            const { steps, summary } = parseResponse(text);
            
            // ÌååÏã±Îêú ÎÇ¥Ïö©Ïù¥ ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ ÌÖçÏä§Ìä∏Î°ú ÌëúÏãú
            if (steps.length === 0 && !summary) {
                return <div className="ai-response"><div className="ai-response-body" style={{fontSize: '13px'}}>{text}</div></div>;
            }
            
            return (
                <div className="ai-response">
                    {steps.length > 0 && (
                        <div className="ai-response-body">
                            {steps.map((step, idx) => (
                                <div key={idx} className="ai-step">
                                    <div className={`ai-step-icon ${step.type}`}>
                                        {step.type === 'done' ? '‚úì' : step.type === 'feature' ? '‚óÜ' : '‚óã'}
                                    </div>
                                    <div className="ai-step-content">
                                        <div className="ai-step-title">{step.title}</div>
                                        <div className="ai-step-desc">{step.desc}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                    {summary && summary.length > 10 && (
                        <div className="ai-summary">{summary.substring(0, 200)}{summary.length > 200 ? '...' : ''}</div>
                    )}
                </div>
            );
        }

        // IA Î∑∞ - manyfast.io Ïä§ÌÉÄÏùº Í≥°ÏÑ† Ïó∞Í≤∞ÏÑ†
        function IAView({ treeData, projectName, onPRDClick }) {
            const containerRef = useRef(null);
            const [connections, setConnections] = useState([]);
            
            useEffect(() => {
                if (containerRef.current) {
                    const updateConnections = () => {
                        const newConnections = [];
                        const cards = containerRef.current.querySelectorAll('.ia-page-card');
                        
                        cards.forEach((card) => {
                            const parentId = card.getAttribute('data-parent-id');
                            if (parentId) {
                                const parentCard = containerRef.current.querySelector(`[data-ia-id="${parentId}"]`);
                                if (parentCard) {
                                    const parentRect = parentCard.getBoundingClientRect();
                                    const cardRect = card.getBoundingClientRect();
                                    const containerRect = containerRef.current.getBoundingClientRect();
                                    
                                    const x1 = parentRect.left + parentRect.width / 2 - containerRect.left;
                                    const y1 = parentRect.bottom - containerRect.top;
                                    const x2 = cardRect.left + cardRect.width / 2 - containerRect.left;
                                    const y2 = cardRect.top - containerRect.top;
                                    
                                    const cy = (y1 + y2) / 2;
                                    
                                    newConnections.push({
                                        id: `${parentId}-${card.getAttribute('data-ia-id')}`,
                                        path: `M ${x1} ${y1} C ${x1} ${cy}, ${x2} ${cy}, ${x2} ${y2}`
                                    });
                                }
                            }
                        });
                        
                        setConnections(newConnections);
                    };
                    
                    updateConnections();
                    const timer = setTimeout(updateConnections, 100);
                    window.addEventListener('resize', updateConnections);
                    return () => {
                        clearTimeout(timer);
                        window.removeEventListener('resize', updateConnections);
                    };
                }
            }, [treeData]);
            
            if (!treeData || treeData.length === 0) {
                return <div className="empty-state"><h3>Í∏∞Îä•ÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî</h3><p>Ï±ÑÌåÖÏ∞ΩÏóêÏÑú Í∏∞Îä•ÏùÑ ÏöîÏ≤≠Ìï¥Î≥¥ÏÑ∏Ïöî</p></div>;
            }
            
            return (
                <div ref={containerRef} className="ia-tree" style={{position: 'relative', minHeight: '600px'}}>
                    <svg style={{position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', pointerEvents: 'none', zIndex: 0}}>
                        {connections.map(conn => (
                            <path key={conn.id} d={conn.path} stroke="rgba(100, 116, 139, 0.3)" strokeWidth="1.5" fill="none" />
                        ))}
                    </svg>
                    
                    <div className="ia-root" style={{position: 'relative', zIndex: 1}}>
                        <div className="ia-root-card" data-ia-id="root">
                            <span className="icon">üìÑ</span>
                            <span className="title">{projectName || 'Untitled'}</span>
                            <span className="prd-link" onClick={onPRDClick}>‚Üó PRD</span>
                        </div>
                    </div>
                    
                    <div style={{height: '60px'}}></div>
                    
                    <IANodeRow nodes={treeData} parentId="root" depth={1} />
                </div>
            );
        }
        
        // IA ÎÖ∏Îìú Ìñâ Ïª¥Ìè¨ÎÑåÌä∏ (Í∞ÄÎ°ú Î∞∞Ïπò)
        function IANodeRow({ nodes, parentId, depth }) {
            if (!nodes || nodes.length === 0) return null;
            
            return (
                <div style={{display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '60px', position: 'relative', zIndex: 1}}>
                    <div style={{display: 'flex', gap: '40px', justifyContent: 'center'}}>
                        {nodes.map((node) => (
                            <div key={node.id} style={{display: 'flex', flexDirection: 'column', alignItems: 'center'}}>
                                <IAPageCard page={node} depth={depth} parentId={parentId} />
                                
                                {node.children && node.children.length > 0 && (
                                    <>
                                        <div style={{height: '60px'}}></div>
                                        <IANodeRow nodes={node.children} parentId={`ia-${node.id}`} depth={depth + 1} />
                                    </>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        function IAPageCard({ page, depth, parentId }) {
            const pageId = `P-${page.id.toString().padStart(4, '0')}`;
            const depthLabel = `${depth}d`;
            
            return (
                <div className="ia-page-card" data-ia-id={`ia-${page.id}`} data-parent-id={parentId}>
                    <div className="ia-page-header">
                        <span className="badge">{depthLabel}</span>
                        <span className="title">{page.title}</span>
                        <span className="id">{pageId}</span>
                    </div>
                    
                    {page.description && (
                        <div className="ia-page-desc">
                            {page.description.substring(0, 80)}{page.description.length > 80 ? '...' : ''}
                        </div>
                    )}
                    
                    {page.children && page.children.length > 0 && (
                        <div className="ia-page-features">
                            <div className="ia-page-features-title">ÌïòÏúÑ {page.children.length}Í∞ú</div>
                            {page.children.slice(0, 3).map(child => (
                                <div key={child.id} className="ia-feature-item">
                                    {child.title}
                                </div>
                            ))}
                            {page.children.length > 3 && (
                                <div className="ia-feature-item" style={{color: '#666'}}>
                                    +{page.children.length - 3} more
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        function TreeView({ treeData }) {
            if (!treeData || treeData.length === 0) return <div className="empty-state"><h3>ÎÖ∏ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§</h3></div>;
            return (
                <div style={{padding: '20px'}}>
                    {treeData.map(node => <TreeNode key={node.id} node={node} level={0} />)}
                </div>
            );
        }

        function TreeNode({ node, level }) {
            return (
                <div style={{marginLeft: level * 24 + 'px', marginBottom: '8px'}}>
                    <div className="node-card" style={{display: 'inline-block'}}>
                        <div className="node-title">{node.title}</div>
                        <div className="node-meta"><span className="badge todo">{node.nodeType}</span></div>
                    </div>
                    {node.children?.map(child => <TreeNode key={child.id} node={child} level={level + 1} />)}
                </div>
            );
        }

        function PRDView({ content, onGenerate }) {
            return (
                <div style={{padding: '20px', maxWidth: '800px'}}>
                    <h2 style={{marginBottom: '16px'}}>PRD Document</h2>
                    {content ? <div className="prd-content">{content}</div> : (
                        <div className="empty-state">
                            <h3>PRDÍ∞Ä ÏóÜÏäµÎãàÎã§</h3>
                            <button className="export-btn" onClick={onGenerate} style={{marginTop: '16px'}}>PRD ÏÉùÏÑ±</button>
                        </div>
                    )}
                </div>
            );
        }

        function NewProjectModal({ onClose, onCreate }) {
            const [name, setName] = useState('');
            const [desc, setDesc] = useState('');
            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <h2>ÏÉà ÌîÑÎ°úÏ†ùÌä∏</h2>
                        <div className="modal-form">
                            <div className="modal-field">
                                <label>ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶Ñ</label>
                                <input placeholder="Ïòà: ÏáºÌïëÎ™∞ MVP" value={name} onChange={e => setName(e.target.value)} autoFocus />
                            </div>
                            <div className="modal-field">
                                <label>ÏÑ§Î™Ö (ÏÑ†ÌÉù)</label>
                                <textarea placeholder="ÌîÑÎ°úÏ†ùÌä∏Ïóê ÎåÄÌïú Í∞ÑÎã®Ìïú ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" rows="3" value={desc} onChange={e => setDesc(e.target.value)} />
                            </div>
                        </div>
                        <div className="modal-buttons">
                            <button className="primary" onClick={() => onCreate(name, desc)} disabled={!name}>ÏÉùÏÑ±</button>
                            <button className="secondary" onClick={onClose}>Ï∑®ÏÜå</button>
                        </div>
                    </div>
                </div>
            );
        }

        function PRDModal({ content, onClose }) {
            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()} style={{width: '700px'}}>
                        <h2>Generated PRD</h2>
                        <div className="prd-content">{content}</div>
                        <div className="modal-buttons" style={{marginTop: '16px'}}>
                            <button className="secondary" onClick={onClose}>Îã´Í∏∞</button>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
