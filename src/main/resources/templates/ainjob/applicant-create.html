<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì›ì ë“±ë¡ - AINJOB</title>
    <link rel="stylesheet" th:href="@{/css/ainjob.css}">
    <style th:replace="~{fragments/navigation :: nav-style}"></style>
</head>
<body>
    <header>
        <nav th:replace="~{fragments/navigation :: nav}"></nav>
    </header>
    
    <div class="ainjob-container">
        <div class="form-container">
            <h2 class="table-title" style="margin-bottom: 24px;">ğŸ‘¥ ì§€ì›ì ë“±ë¡</h2>
            
            <form id="applicant-form" onsubmit="handleSubmit(event)">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="detail-section">
                    <h3 class="detail-section-title">ê¸°ë³¸ ì •ë³´</h3>
                    
                    <div class="form-group">
                        <label class="form-label">ì´ë¦„ *</label>
                        <input type="text" class="form-input" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì´ë©”ì¼ *</label>
                        <input type="email" class="form-input" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" class="form-input" name="phone" placeholder="010-1234-5678">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ìƒë…„ì›”ì¼</label>
                        <input type="date" class="form-input" name="birthDate">
                    </div>
                </div>
                
                <!-- ì£¼ì†Œ -->
                <div class="detail-section">
                    <h3 class="detail-section-title">ì£¼ì†Œ</h3>
                    
                    <div class="form-group">
                        <label class="form-label">ë„ì‹œ</label>
                        <input type="text" class="form-input" name="city" placeholder="ì„œìš¸">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">êµ¬/êµ°</label>
                        <input type="text" class="form-input" name="district" placeholder="ê°•ë‚¨êµ¬">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ìƒì„¸ ì£¼ì†Œ</label>
                        <input type="text" class="form-input" name="addressDetail" placeholder="í…Œí—¤ë€ë¡œ 123">
                    </div>
                </div>
                
                <!-- í•™ë ¥ -->
                <div class="detail-section">
                    <h3 class="detail-section-title">í•™ë ¥</h3>
                    
                    <div class="form-group">
                        <label class="form-label">í•™ë ¥ ìˆ˜ì¤€ *</label>
                        <select class="form-select" name="educationLevel" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="HIGH_SCHOOL">ê³ ë“±í•™êµ</option>
                            <option value="ASSOCIATE">ì „ë¬¸í•™ì‚¬</option>
                            <option value="BACHELOR">í•™ì‚¬</option>
                            <option value="MASTER">ì„ì‚¬</option>
                            <option value="DOCTORATE">ë°•ì‚¬</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì „ê³µ *</label>
                        <input type="text" class="form-input" name="majorName" required placeholder="ì»´í“¨í„°ê³µí•™">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">í•™êµëª… *</label>
                        <input type="text" class="form-input" name="schoolName" required placeholder="ì„œìš¸ëŒ€í•™êµ">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì…í•™ì¼</label>
                        <input type="date" class="form-input" name="educationStartDate">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì¡¸ì—…ì¼</label>
                        <input type="date" class="form-input" name="educationEndDate">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ìƒíƒœ</label>
                        <select class="form-select" name="educationStatus">
                            <option value="GRADUATED">ì¡¸ì—…</option>
                            <option value="IN_PROGRESS">ì¬í•™ì¤‘</option>
                            <option value="LEAVE">íœ´í•™</option>
                        </select>
                    </div>
                </div>
                
                <!-- ê²½ë ¥ -->
                <div class="detail-section">
                    <h3 class="detail-section-title">ê²½ë ¥ (ì„ íƒ)</h3>
                    
                    <div class="form-group">
                        <label class="form-label">íšŒì‚¬ëª…</label>
                        <input type="text" class="form-input" name="companyName" placeholder="ë„¤ì´ë²„">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì§ì±…</label>
                        <input type="text" class="form-input" name="position" placeholder="Backend Developer">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì—…ë¬´ ì„¤ëª…</label>
                        <textarea class="form-textarea" name="careerDescription" 
                                  placeholder="Java/Spring Boot ê¸°ë°˜ ì„œë¹„ìŠ¤ ê°œë°œ"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì…ì‚¬ì¼</label>
                        <input type="date" class="form-input" name="careerStartDate">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">í‡´ì‚¬ì¼ (ì¬ì§ì¤‘ì´ë©´ ë¹„ì›Œë‘ì„¸ìš”)</label>
                        <input type="date" class="form-input" name="careerEndDate">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ë³´ìœ  ìŠ¤í‚¬ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                        <input type="text" class="form-input" name="skills" 
                               placeholder="Java, Spring Boot, AWS">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn-primary">ë“±ë¡í•˜ê¸°</button>
                    <button type="button" class="btn-secondary" onclick="history.back()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>
    
    <script th:replace="~{fragments/navigation :: nav-script}"></script>
    <script>
        async function handleSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // ê¸°ë³¸ ì •ë³´
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone') || null,
                birthDate: formData.get('birthDate') || null,
                address: {
                    city: formData.get('city') || null,
                    district: formData.get('district') || null,
                    detail: formData.get('addressDetail') || null
                },
                educations: [{
                    level: formData.get('educationLevel'),
                    majorName: formData.get('majorName'),
                    schoolName: formData.get('schoolName'),
                    startDate: formData.get('educationStartDate') || null,
                    endDate: formData.get('educationEndDate') || null,
                    status: formData.get('educationStatus') || 'GRADUATED'
                }],
                careers: []
            };
            
            // ê²½ë ¥ ì •ë³´ (ì…ë ¥ëœ ê²½ìš°ì—ë§Œ)
            if (formData.get('companyName')) {
                const skills = formData.get('skills') 
                    ? formData.get('skills').split(',').map(s => ({
                        skillName: s.trim(),
                        proficiencyLevel: 3
                    }))
                    : [];
                
                data.careers.push({
                    companyName: formData.get('companyName'),
                    position: formData.get('position') || null,
                    description: formData.get('careerDescription') || null,
                    startDate: formData.get('careerStartDate') || null,
                    endDate: formData.get('careerEndDate') || null,
                    skills: skills
                });
            }
            
            try {
                const response = await fetch('/api/ainjob/applicants', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'ì§€ì›ì ë“±ë¡ ì‹¤íŒ¨');
                }
                
                const result = await response.json();
                alert('ì§€ì›ìê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                location.href = '/ainjob/applicants/' + result.id;
                
            } catch (error) {
                console.error('ì§€ì›ì ë“±ë¡ ì‹¤íŒ¨:', error);
                alert('ì§€ì›ì ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
    </script>
</body>
</html>
