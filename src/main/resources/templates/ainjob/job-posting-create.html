<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„ìš© ê³µê³  ì‘ì„± - ì§ì‡ë‹¤</title>
    <link rel="stylesheet" th:href="@{/css/ainjob.css}">
    <style th:replace="~{fragments/navigation :: nav-style}"></style>
</head>
<body>
    <header>
        <nav th:replace="~{fragments/navigation :: nav}"></nav>
    </header>
    
    <div class="ainjob-container">
        <div class="form-container">
            <h2 class="table-title" style="margin-bottom: 24px;">ğŸ“‹ ì±„ìš© ê³µê³  ì‘ì„±</h2>
            
            <form id="job-posting-form" onsubmit="handleSubmit(event)">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="detail-section">
                    <h3 class="detail-section-title">ê¸°ë³¸ ì •ë³´</h3>
                    
                    <div class="form-group">
                        <label class="form-label">íšŒì‚¬ ID *</label>
                        <input type="number" class="form-input" name="companyId" value="1" required>
                        <small style="color: #6c757d;">ì„ì‹œë¡œ 1ì„ ì‚¬ìš©í•©ë‹ˆë‹¤</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ê³µê³  ì œëª© *</label>
                        <input type="text" class="form-input" name="title" required 
                               value="ì‹œë‹ˆì–´ ë°±ì—”ë“œ ê°œë°œì ì±„ìš©"
                               placeholder="ì˜ˆ: ë°±ì—”ë“œ ê°œë°œì ì±„ìš©">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">í¬ì§€ì…˜ *</label>
                        <input type="text" class="form-input" name="position" required 
                               value="BACKEND"
                               placeholder="ì˜ˆ: BACKEND, FRONTEND, FULLSTACK">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ìƒì„¸ ì„¤ëª…</label>
                        <textarea class="form-textarea" name="description" 
                                  placeholder="ì±„ìš© ê³µê³  ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”">Java/Spring Boot ê¸°ë°˜ ë°±ì—”ë“œ ê°œë°œìë¥¼ ëª¨ì§‘í•©ë‹ˆë‹¤.
MSA ì•„í‚¤í…ì²˜ ê²½í—˜ì´ ìˆìœ¼ì‹  ë¶„ì„ ìš°ëŒ€í•©ë‹ˆë‹¤.
AWS í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œì˜ ê°œë°œ ê²½í—˜ì´ í•„ìš”í•©ë‹ˆë‹¤.</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì˜¤í”ˆì¼</label>
                        <input type="date" class="form-input" name="openDate" value="2025-01-01">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ë§ˆê°ì¼</label>
                        <input type="date" class="form-input" name="closeDate" value="2025-12-31">
                    </div>
                </div>
                
                <!-- ìê²© ìš”ê±´ -->
                <div class="detail-section">
                    <h3 class="detail-section-title">ìê²© ìš”ê±´</h3>
                    
                    <div class="form-group">
                        <label class="form-label">ìµœì†Œ í•™ë ¥ *</label>
                        <select class="form-select" name="minEducationLevel" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="HIGH_SCHOOL">ê³ ë“±í•™êµ</option>
                            <option value="ASSOCIATE">ì „ë¬¸í•™ì‚¬</option>
                            <option value="BACHELOR" selected>í•™ì‚¬</option>
                            <option value="MASTER">ì„ì‚¬</option>
                            <option value="DOCTORATE">ë°•ì‚¬</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">í—ˆìš© ì „ê³µ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                        <input type="text" class="form-input" name="acceptedMajors" 
                               value="ì»´í“¨í„°ê³µí•™, ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™, ì •ë³´ë³´ì•ˆ"
                               placeholder="ì˜ˆ: ì»´í“¨í„°ê³µí•™, ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™, ì •ë³´ë³´ì•ˆ">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ìµœì†Œ ê²½ë ¥ ì—°ì°¨</label>
                        <input type="number" class="form-input" name="minYearsOfExperience" 
                               value="5" min="0" placeholder="0">
                    </div>
                </div>
                
                <!-- ìš”êµ¬ ìŠ¤í‚¬ -->
                <div class="detail-section">
                    <h3 class="detail-section-title">ìš”êµ¬ ìŠ¤í‚¬</h3>
                    
                    <div id="skills-container">
                        <div class="skill-item" style="margin-bottom: 16px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
                            <div class="form-group">
                                <label class="form-label">ìŠ¤í‚¬ëª… *</label>
                                <input type="text" class="form-input" name="skillName[]" required 
                                       value="Java"
                                       placeholder="ì˜ˆ: Java">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">í•„ìˆ˜ ì—¬ë¶€</label>
                                <select class="form-select" name="isRequired[]">
                                    <option value="true" selected>í•„ìˆ˜</option>
                                    <option value="false">ì„ íƒ</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ìµœì†Œ ìˆ™ë ¨ë„ (1-5)</label>
                                <input type="number" class="form-input" name="minProficiency[]" 
                                       min="1" max="5" value="4">
                            </div>
                        </div>
                        <div class="skill-item" style="margin-bottom: 16px; padding: 16px; background: #f8f9fa; border-radius: 8px; position: relative;">
                            <button type="button" onclick="this.parentElement.remove()" 
                                    style="position: absolute; top: 8px; right: 8px; background: #dc3545; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">
                                ì‚­ì œ
                            </button>
                            <div class="form-group">
                                <label class="form-label">ìŠ¤í‚¬ëª… *</label>
                                <input type="text" class="form-input" name="skillName[]" required 
                                       value="Spring Boot"
                                       placeholder="ì˜ˆ: Spring Boot">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">í•„ìˆ˜ ì—¬ë¶€</label>
                                <select class="form-select" name="isRequired[]">
                                    <option value="true" selected>í•„ìˆ˜</option>
                                    <option value="false">ì„ íƒ</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ìµœì†Œ ìˆ™ë ¨ë„ (1-5)</label>
                                <input type="number" class="form-input" name="minProficiency[]" 
                                       min="1" max="5" value="4">
                            </div>
                        </div>
                        <div class="skill-item" style="margin-bottom: 16px; padding: 16px; background: #f8f9fa; border-radius: 8px; position: relative;">
                            <button type="button" onclick="this.parentElement.remove()" 
                                    style="position: absolute; top: 8px; right: 8px; background: #dc3545; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">
                                ì‚­ì œ
                            </button>
                            <div class="form-group">
                                <label class="form-label">ìŠ¤í‚¬ëª… *</label>
                                <input type="text" class="form-input" name="skillName[]" required 
                                       value="AWS"
                                       placeholder="ì˜ˆ: AWS">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">í•„ìˆ˜ ì—¬ë¶€</label>
                                <select class="form-select" name="isRequired[]">
                                    <option value="true" selected>í•„ìˆ˜</option>
                                    <option value="false">ì„ íƒ</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ìµœì†Œ ìˆ™ë ¨ë„ (1-5)</label>
                                <input type="number" class="form-input" name="minProficiency[]" 
                                       min="1" max="5" value="3">
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="btn-secondary" onclick="addSkill()" 
                            style="width: auto; margin-bottom: 16px;">
                        â• ìŠ¤í‚¬ ì¶”ê°€
                    </button>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn-primary">ê³µê³  ë“±ë¡</button>
                    <button type="button" class="btn-secondary" onclick="location.href='/ainjob/job-postings'">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>
    
    <script th:replace="~{fragments/navigation :: nav-script}"></script>
    <script>
        function addSkill() {
            const container = document.getElementById('skills-container');
            const skillItem = document.createElement('div');
            skillItem.className = 'skill-item';
            skillItem.style.cssText = 'margin-bottom: 16px; padding: 16px; background: #f8f9fa; border-radius: 8px; position: relative;';
            skillItem.innerHTML = `
                <button type="button" onclick="this.parentElement.remove()" 
                        style="position: absolute; top: 8px; right: 8px; background: #dc3545; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">
                    ì‚­ì œ
                </button>
                <div class="form-group">
                    <label class="form-label">ìŠ¤í‚¬ëª… *</label>
                    <input type="text" class="form-input" name="skillName[]" required 
                           placeholder="ì˜ˆ: Spring Boot">
                </div>
                
                <div class="form-group">
                    <label class="form-label">í•„ìˆ˜ ì—¬ë¶€</label>
                    <select class="form-select" name="isRequired[]">
                        <option value="true">í•„ìˆ˜</option>
                        <option value="false">ì„ íƒ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ìµœì†Œ ìˆ™ë ¨ë„ (1-5)</label>
                    <input type="number" class="form-input" name="minProficiency[]" 
                           min="1" max="5" value="3">
                </div>
            `;
            container.appendChild(skillItem);
        }
        
        async function handleSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // ìŠ¤í‚¬ ë°°ì—´ ìƒì„±
            const skillNames = formData.getAll('skillName[]');
            const isRequiredList = formData.getAll('isRequired[]');
            const minProficiencyList = formData.getAll('minProficiency[]');
            
            const requiredSkills = skillNames.map((name, index) => ({
                skillName: name,
                isRequired: isRequiredList[index] === 'true',
                minProficiency: parseInt(minProficiencyList[index]) || 3
            }));
            
            // í—ˆìš© ì „ê³µ ë°°ì—´ ìƒì„±
            const acceptedMajorsStr = formData.get('acceptedMajors');
            const acceptedMajors = acceptedMajorsStr 
                ? acceptedMajorsStr.split(',').map(m => m.trim()).filter(m => m)
                : [];
            
            // ìš”ì²­ ë°ì´í„° ìƒì„±
            const data = {
                companyId: parseInt(formData.get('companyId')),
                title: formData.get('title'),
                description: formData.get('description') || null,
                position: formData.get('position'),
                qualification: {
                    minEducationLevel: formData.get('minEducationLevel'),
                    acceptedMajors: acceptedMajors,
                    minYearsOfExperience: parseInt(formData.get('minYearsOfExperience')) || 0
                },
                requiredSkills: requiredSkills,
                openDate: formData.get('openDate') || null,
                closeDate: formData.get('closeDate') || null
            };
            
            try {
                const response = await fetch('/api/ainjob/job-postings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'ì±„ìš© ê³µê³  ë“±ë¡ ì‹¤íŒ¨');
                }
                
                const result = await response.json();
                alert('ì±„ìš© ê³µê³ ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                location.href = '/ainjob/job-postings/' + result.id;
                
            } catch (error) {
                console.error('ì±„ìš© ê³µê³  ë“±ë¡ ì‹¤íŒ¨:', error);
                alert('ì±„ìš© ê³µê³  ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
    </script>
</body>
</html>
