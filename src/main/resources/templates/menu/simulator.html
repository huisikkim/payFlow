<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${menu.name} + ' - ë§ˆì§„ ì‹œë®¬ë ˆì´í„°'">ë§ˆì§„ ì‹œë®¬ë ˆì´í„°</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .header { background: white; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .back-btn { display: inline-block; padding: 8px 16px; background: #6c757d; color: white; text-decoration: none; border-radius: 6px; margin-bottom: 15px; }
        .back-btn:hover { background: #5a6268; }
        h1 { color: #333; margin-bottom: 10px; }
        .subtitle { color: #666; font-size: 14px; }
        .current-info { background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .current-info h3 { color: #1976d2; margin-bottom: 10px; }
        .current-info p { color: #333; line-height: 1.8; }
        .simulator-section { background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .section-title { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #007bff; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-weight: 600; color: #495057; margin-bottom: 8px; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
        .input-group input:focus { outline: none; border-color: #007bff; }
        .btn { display: inline-block; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin-right: 10px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .result-box { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px; display: none; }
        .result-box.show { display: block; }
        .result-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #dee2e6; }
        .result-item:last-child { border-bottom: none; }
        .result-label { font-weight: 600; color: #495057; }
        .result-value { font-weight: bold; color: #333; }
        .result-value.positive { color: #2e7d32; }
        .result-value.negative { color: #c62828; }
        .comparison { background: #fff3cd; padding: 15px; border-radius: 6px; margin-top: 15px; }
        .comparison h4 { color: #856404; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a th:href="@{/menu/{id}(id=${menu.id})}" class="back-btn">â† ì›ê°€ ë¶„ì„ìœ¼ë¡œ</a>
            <h1>ğŸ’° ë§ˆì§„ ì‹œë®¬ë ˆì´í„°</h1>
            <p class="subtitle" th:text="${menu.name}">ë©”ë‰´ëª…</p>
        </div>

        <div class="current-info">
            <h3>ğŸ“Š í˜„ì¬ ì •ë³´</h3>
            <p>
                <strong>ì´ ì›ê°€:</strong> <span th:text="${#numbers.formatInteger(analysis.totalCost, 0, 'COMMA')} + 'ì›'">0ì›</span><br>
                <strong>í˜„ì¬ íŒë§¤ê°€:</strong> <span th:text="${#numbers.formatInteger(analysis.sellingPrice, 0, 'COMMA')} + 'ì›'">0ì›</span><br>
                <strong>í˜„ì¬ ë§ˆì§„ìœ¨:</strong> <span th:text="${#numbers.formatDecimal(analysis.marginRate, 1, 2)} + '%'">0%</span><br>
                <strong>í˜„ì¬ ìˆœì´ìµ:</strong> <span th:text="${#numbers.formatInteger(analysis.grossProfit, 0, 'COMMA')} + 'ì›'">0ì›</span>
            </p>
        </div>

        <div class="simulator-section">
            <h2 class="section-title">ğŸ’µ ê°€ê²© ê¸°ë°˜ ì‹œë®¬ë ˆì´ì…˜</h2>
            <p style="color: #666; margin-bottom: 20px;">ëª©í‘œ íŒë§¤ê°€ë¥¼ ì…ë ¥í•˜ë©´ ì˜ˆìƒ ë§ˆì§„ìœ¨ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
            
            <div class="input-group">
                <label for="targetPrice">ëª©í‘œ íŒë§¤ê°€ (ì›)</label>
                <input type="number" id="targetPrice" placeholder="ì˜ˆ: 10000" th:value="${analysis.sellingPrice}">
            </div>
            
            <button class="btn btn-primary" onclick="simulateByPrice()">ê³„ì‚°í•˜ê¸°</button>
            
            <div id="priceResult" class="result-box">
                <div class="result-item">
                    <span class="result-label">ëª©í‘œ íŒë§¤ê°€</span>
                    <span class="result-value" id="priceResultPrice">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì˜ˆìƒ ë§ˆì§„ìœ¨</span>
                    <span class="result-value" id="priceResultMargin">0%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì˜ˆìƒ ìˆœì´ìµ</span>
                    <span class="result-value positive" id="priceResultProfit">0ì›</span>
                </div>
                <div class="comparison">
                    <h4>ğŸ“ˆ í˜„ì¬ ëŒ€ë¹„ ë³€í™”</h4>
                    <p>
                        <strong>ê°€ê²© ì°¨ì´:</strong> <span id="priceDiff">0ì›</span><br>
                        <strong>ë§ˆì§„ìœ¨ ì°¨ì´:</strong> <span id="marginDiff">0%</span>
                    </p>
                </div>
            </div>
        </div>

        <div class="simulator-section">
            <h2 class="section-title">ğŸ“Š ë§ˆì§„ìœ¨ ê¸°ë°˜ ì‹œë®¬ë ˆì´ì…˜</h2>
            <p style="color: #666; margin-bottom: 20px;">ëª©í‘œ ë§ˆì§„ìœ¨ì„ ì…ë ¥í•˜ë©´ í•„ìš”í•œ íŒë§¤ê°€ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
            
            <div class="input-group">
                <label for="targetMargin">ëª©í‘œ ë§ˆì§„ìœ¨ (%)</label>
                <input type="number" id="targetMargin" placeholder="ì˜ˆ: 35" step="0.1" th:value="${analysis.marginRate}">
            </div>
            
            <button class="btn btn-success" onclick="simulateByMargin()">ê³„ì‚°í•˜ê¸°</button>
            
            <div id="marginResult" class="result-box">
                <div class="result-item">
                    <span class="result-label">ëª©í‘œ ë§ˆì§„ìœ¨</span>
                    <span class="result-value" id="marginResultMargin">0%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">í•„ìš” íŒë§¤ê°€</span>
                    <span class="result-value" id="marginResultPrice">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì˜ˆìƒ ìˆœì´ìµ</span>
                    <span class="result-value positive" id="marginResultProfit">0ì›</span>
                </div>
                <div class="comparison">
                    <h4>ğŸ“ˆ í˜„ì¬ ëŒ€ë¹„ ë³€í™”</h4>
                    <p>
                        <strong>ê°€ê²© ì°¨ì´:</strong> <span id="marginPriceDiff">0ì›</span><br>
                        <strong>ë§ˆì§„ìœ¨ ì°¨ì´:</strong> <span id="marginMarginDiff">0%</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        const menuId = /*[[${menu.id}]]*/ 0;
        const totalCost = /*[[${analysis.totalCost}]]*/ 0;

        function simulateByPrice() {
            const targetPrice = parseInt(document.getElementById('targetPrice').value);
            if (!targetPrice || targetPrice <= 0) {
                alert('ì˜¬ë°”ë¥¸ íŒë§¤ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            fetch(`/api/menu/${menuId}/simulate/price?targetPrice=${targetPrice}`)
                .then(res => res.json())
                .then(data => {
                    document.getElementById('priceResultPrice').textContent = formatNumber(data.targetSellingPrice) + 'ì›';
                    document.getElementById('priceResultMargin').textContent = data.targetMarginRate.toFixed(2) + '%';
                    document.getElementById('priceResultProfit').textContent = formatNumber(data.targetSellingPrice - totalCost) + 'ì›';
                    
                    const priceDiff = data.priceDifference;
                    const marginDiff = data.marginDifference;
                    
                    document.getElementById('priceDiff').textContent = (priceDiff >= 0 ? '+' : '') + formatNumber(priceDiff) + 'ì›';
                    document.getElementById('priceDiff').style.color = priceDiff >= 0 ? '#2e7d32' : '#c62828';
                    
                    document.getElementById('marginDiff').textContent = (marginDiff >= 0 ? '+' : '') + marginDiff.toFixed(2) + '%';
                    document.getElementById('marginDiff').style.color = marginDiff >= 0 ? '#2e7d32' : '#c62828';
                    
                    document.getElementById('priceResult').classList.add('show');
                })
                .catch(err => alert('ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨: ' + err.message));
        }

        function simulateByMargin() {
            const targetMargin = parseFloat(document.getElementById('targetMargin').value);
            if (!targetMargin || targetMargin < 0 || targetMargin >= 100) {
                alert('ì˜¬ë°”ë¥¸ ë§ˆì§„ìœ¨ì„ ì…ë ¥í•˜ì„¸ìš” (0-100).');
                return;
            }

            fetch(`/api/menu/${menuId}/simulate/margin?targetMargin=${targetMargin}`)
                .then(res => res.json())
                .then(data => {
                    document.getElementById('marginResultMargin').textContent = data.targetMarginRate.toFixed(2) + '%';
                    document.getElementById('marginResultPrice').textContent = formatNumber(data.targetSellingPrice) + 'ì›';
                    document.getElementById('marginResultProfit').textContent = formatNumber(data.targetSellingPrice - totalCost) + 'ì›';
                    
                    const priceDiff = data.priceDifference;
                    const marginDiff = data.marginDifference;
                    
                    document.getElementById('marginPriceDiff').textContent = (priceDiff >= 0 ? '+' : '') + formatNumber(priceDiff) + 'ì›';
                    document.getElementById('marginPriceDiff').style.color = priceDiff >= 0 ? '#2e7d32' : '#c62828';
                    
                    document.getElementById('marginMarginDiff').textContent = (marginDiff >= 0 ? '+' : '') + marginDiff.toFixed(2) + '%';
                    document.getElementById('marginMarginDiff').style.color = marginDiff >= 0 ? '#2e7d32' : '#c62828';
                    
                    document.getElementById('marginResult').classList.add('show');
                })
                .catch(err => alert('ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨: ' + err.message));
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
    </script>
</body>
</html>
