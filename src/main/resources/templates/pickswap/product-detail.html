<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒí’ˆ ìƒì„¸ - Pick Swap</title>
    <link rel="stylesheet" th:href="@{/css/pickswap.css}">
    <style>
        .detail-container {
            max-width: 1280px;
            margin: 32px auto;
            padding: 0 24px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 48px;
        }
        
        .image-section {
            position: sticky;
            top: 100px;
            height: fit-content;
        }
        
        .main-image {
            width: 100%;
            height: 500px;
            object-fit: cover;
            border-radius: 12px;
            background: var(--light-bg);
            border: 1px solid var(--border-color);
        }
        
        .thumbnail-list {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            overflow-x: auto;
        }
        
        .thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .thumbnail:hover,
        .thumbnail.active {
            border-color: var(--primary-color);
        }
        
        .info-section {
            padding: 24px 0;
        }
        
        .product-header {
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .product-detail-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }
        
        .product-detail-price {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }
        
        .product-stats {
            display: flex;
            gap: 24px;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .seller-info {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 24px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .seller-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .seller-details h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .seller-details p {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .product-description {
            padding: 24px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .product-description h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .product-description p {
            font-size: 15px;
            line-height: 1.8;
            color: var(--text-secondary);
            white-space: pre-wrap;
        }
        
        .product-details {
            padding: 24px 0;
        }
        
        .detail-row {
            display: flex;
            padding: 12px 0;
            font-size: 15px;
        }
        
        .detail-label {
            width: 120px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .detail-value {
            flex: 1;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .action-buttons {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 24px 0;
            display: flex;
            gap: 12px;
        }
        
        .btn-action {
            flex: 1;
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-like {
            background: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }
        
        .btn-like:hover {
            background: rgba(9, 177, 186, 0.05);
        }
        
        .btn-chat {
            background: var(--primary-color);
            color: white;
            border: 1px solid var(--primary-color);
        }
        
        .btn-chat:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(9, 177, 186, 0.3);
        }
        
        @media (max-width: 768px) {
            .detail-container {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .image-section {
                position: static;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="pickswap-header">
        <div class="header-container">
            <a href="/pickswap" class="logo">
                <svg class="logo-svg" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- ì™¼ìª½ í™”ì‚´í‘œ -->
                    <path d="M8 16L14 10L14 13L18 13L18 10L24 16L18 22L18 19L14 19L14 22L8 16Z" fill="#09B1BA"/>
                    <!-- ì™¸ê³½ ì› -->
                    <circle cx="16" cy="16" r="14" stroke="#09B1BA" stroke-width="2" fill="none"/>
                    <!-- ì‘ì€ ì ë“¤ (ê±°ë˜ ëŠë‚Œ) -->
                    <circle cx="6" cy="16" r="1.5" fill="#13C1CA"/>
                    <circle cx="26" cy="16" r="1.5" fill="#13C1CA"/>
                </svg>
                <span class="logo-text">Pick Swap</span>
            </a>
            
            <div class="search-bar">
                <input type="text" 
                       id="search-input" 
                       class="search-input" 
                       placeholder="ì–´ë–¤ ìƒí’ˆì„ ì°¾ìœ¼ì‹œë‚˜ìš”?">
                <button id="search-btn" class="search-btn">
                    ğŸ”
                </button>
            </div>
            
            <div class="nav-actions">
                <a href="/pickswap/sell" class="nav-btn btn-sell">
                    âœ¨ íŒë§¤í•˜ê¸°
                </a>
                <a href="/pickswap/my-products" class="nav-btn btn-my-products">
                    ğŸ“¦ ë‚´ ìƒí’ˆ
                </a>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="detail-container">
        <!-- Image Section -->
        <div class="image-section">
            <img id="main-image" 
                 src="https://via.placeholder.com/600x500" 
                 alt="Product Image" 
                 class="main-image">
            <div id="thumbnail-list" class="thumbnail-list">
                <!-- Thumbnails will be loaded here -->
            </div>
        </div>
        
        <!-- Info Section -->
        <div class="info-section">
            <div class="product-header">
                <div id="status-badge"></div>
                <h1 id="product-title" class="product-detail-title">ìƒí’ˆ ì œëª©</h1>
                <div id="product-price" class="product-detail-price">0ì›</div>
                <div class="product-stats">
                    <span id="view-count">ğŸ‘ï¸ 0</span>
                    <span id="like-count">â¤ï¸ 0</span>
                    <span id="chat-count">ğŸ’¬ 0</span>
                    <span id="created-at">â° ë°©ê¸ˆ ì „</span>
                </div>
            </div>
            
            <div class="seller-info">
                <div class="seller-avatar">ğŸ‘¤</div>
                <div class="seller-details">
                    <h3 id="seller-name">íŒë§¤ì</h3>
                    <p id="seller-location">ğŸ“ ìœ„ì¹˜</p>
                </div>
            </div>
            
            <div class="product-description">
                <h3>ìƒí’ˆ ì„¤ëª…</h3>
                <p id="product-description">ìƒí’ˆ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
            
            <div class="product-details">
                <div class="detail-row">
                    <span class="detail-label">ì¹´í…Œê³ ë¦¬</span>
                    <span id="category" class="detail-value">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ìƒí’ˆ ìƒíƒœ</span>
                    <span id="condition" class="detail-value">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ê±°ë˜ ì§€ì—­</span>
                    <span id="location" class="detail-value">-</span>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="btn-like" class="btn-action btn-like">
                    â¤ï¸ ì°œí•˜ê¸°
                </button>
                <button id="btn-chat" class="btn-action btn-chat">
                    ğŸ’¬ ì±„íŒ…í•˜ê¸°
                </button>
            </div>
        </div>
    </div>
    
    <script>
        const productId = window.location.pathname.split('/').pop();
        
        // ìƒí’ˆ ìƒì„¸ ì •ë³´ ë¡œë“œ
        async function loadProductDetail() {
            try {
                const response = await fetch(`/api/products/${productId}`);
                const product = await response.json();
                
                displayProduct(product);
            } catch (error) {
                console.error('ìƒí’ˆ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/pickswap';
            }
        }
        
        // ìƒí’ˆ ì •ë³´ í‘œì‹œ
        function displayProduct(product) {
            // ìƒíƒœ ë±ƒì§€
            const statusBadges = {
                'AVAILABLE': '<span class="status-badge status-available">íŒë§¤ì¤‘</span>',
                'RESERVED': '<span class="status-badge status-reserved">ì˜ˆì•½ì¤‘</span>',
                'SOLD': '<span class="status-badge status-sold">íŒë§¤ì™„ë£Œ</span>'
            };
            document.getElementById('status-badge').innerHTML = statusBadges[product.status] || '';
            
            // ê¸°ë³¸ ì •ë³´
            document.getElementById('product-title').textContent = product.title;
            document.getElementById('product-price').textContent = formatPrice(product.price) + 'ì›';
            document.getElementById('view-count').textContent = `ğŸ‘ï¸ ${product.viewCount}`;
            document.getElementById('like-count').textContent = `â¤ï¸ ${product.likeCount}`;
            document.getElementById('chat-count').textContent = `ğŸ’¬ ${product.chatCount}`;
            document.getElementById('created-at').textContent = `â° ${formatDate(product.createdAt)}`;
            
            // íŒë§¤ì ì •ë³´
            document.getElementById('seller-name').textContent = product.sellerName;
            document.getElementById('seller-location').textContent = `ğŸ“ ${product.location || 'ìœ„ì¹˜ ë¯¸ì •'}`;
            
            // ìƒí’ˆ ì„¤ëª…
            document.getElementById('product-description').textContent = product.description || 'ìƒí’ˆ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.';
            
            // ìƒì„¸ ì •ë³´
            document.getElementById('category').textContent = getCategoryName(product.category);
            document.getElementById('condition').textContent = getConditionName(product.productCondition);
            document.getElementById('location').textContent = product.location || 'ìœ„ì¹˜ ë¯¸ì •';
            
            // ì´ë¯¸ì§€
            if (product.imageUrls && product.imageUrls.length > 0) {
                document.getElementById('main-image').src = product.imageUrls[0];
                
                const thumbnailList = document.getElementById('thumbnail-list');
                thumbnailList.innerHTML = product.imageUrls.map((url, index) => `
                    <img src="${url}" 
                         alt="Thumbnail ${index + 1}" 
                         class="thumbnail ${index === 0 ? 'active' : ''}"
                         onclick="changeMainImage('${url}', this)">
                `).join('');
            }
        }
        
        // ë©”ì¸ ì´ë¯¸ì§€ ë³€ê²½
        function changeMainImage(url, thumbnail) {
            document.getElementById('main-image').src = url;
            document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
            thumbnail.classList.add('active');
        }
        
        // ì°œí•˜ê¸°
        document.getElementById('btn-like').addEventListener('click', async () => {
            try {
                await fetch(`/api/products/${productId}/like`, { method: 'POST' });
                alert('ì°œ ëª©ë¡ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                loadProductDetail(); // ìƒˆë¡œê³ ì¹¨
            } catch (error) {
                console.error('ì°œí•˜ê¸° ì‹¤íŒ¨:', error);
                alert('ì°œí•˜ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });
        
        // ì±„íŒ…í•˜ê¸°
        document.getElementById('btn-chat').addEventListener('click', () => {
            alert('ì±„íŒ… ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤!');
        });
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function formatPrice(price) {
            return new Intl.NumberFormat('ko-KR').format(price);
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'ë°©ê¸ˆ ì „';
            if (minutes < 60) return `${minutes}ë¶„ ì „`;
            if (hours < 24) return `${hours}ì‹œê°„ ì „`;
            if (days < 7) return `${days}ì¼ ì „`;
            
            return date.toLocaleDateString('ko-KR');
        }
        
        function getCategoryName(category) {
            const names = {
                'ELECTRONICS': 'ğŸ“± ì „ìê¸°ê¸°',
                'FASHION': 'ğŸ‘• íŒ¨ì…˜/ì˜ë¥˜',
                'HOME_APPLIANCES': 'ğŸ”Œ ê°€ì „ì œí’ˆ',
                'FURNITURE': 'ğŸ›‹ï¸ ê°€êµ¬/ì¸í…Œë¦¬ì–´',
                'BOOKS': 'ğŸ“š ë„ì„œ',
                'SPORTS': 'âš½ ìŠ¤í¬ì¸ /ë ˆì €',
                'TOYS': 'ğŸ® ì™„êµ¬/ì·¨ë¯¸',
                'BEAUTY': 'ğŸ’„ ë·°í‹°/ë¯¸ìš©',
                'PET_SUPPLIES': 'ğŸ¾ ë°˜ë ¤ë™ë¬¼ìš©í’ˆ',
                'OTHERS': 'ğŸ“¦ ê¸°íƒ€'
            };
            return names[category] || category;
        }
        
        function getConditionName(condition) {
            const names = {
                'NEW': 'ğŸ†• ìƒˆ ìƒí’ˆ',
                'LIKE_NEW': 'âœ¨ ê±°ì˜ ìƒˆê²ƒ',
                'GOOD': 'ğŸ‘ ì¢‹ìŒ',
                'FAIR': 'ğŸ‘Œ ë³´í†µ',
                'POOR': 'ğŸ”§ ë‚˜ì¨'
            };
            return names[condition] || condition;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        loadProductDetail();
    </script>
</body>
</html>
