<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒí’ˆ ë“±ë¡ - Pick Swap</title>
    <link rel="stylesheet" th:href="@{/css/pickswap.css}">
    <style>
        .sell-container {
            max-width: 800px;
            margin: 32px auto;
            padding: 0 24px;
        }
        
        .sell-header {
            text-align: center;
            margin-bottom: 48px;
        }
        
        .sell-header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .sell-header p {
            font-size: 16px;
            color: var(--text-secondary);
        }
        
        .sell-form {
            background: white;
            border-radius: 12px;
            padding: 32px;
            border: 1px solid var(--border-color);
        }
        
        .form-section {
            margin-bottom: 32px;
        }
        
        .form-section:last-child {
            margin-bottom: 0;
        }
        
        .form-label {
            display: block;
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }
        
        .form-label .required {
            color: var(--primary-color);
        }
        
        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
            background-color: var(--light-bg);
        }
        
        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(9, 177, 186, 0.1);
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }
        
        .image-upload {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--light-bg);
        }
        
        .image-upload:hover {
            border-color: var(--primary-color);
            background: rgba(9, 177, 186, 0.05);
        }
        
        .image-upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }
        
        .image-upload-text {
            font-size: 15px;
            color: var(--text-secondary);
        }
        
        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .preview-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .preview-remove {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .submit-section {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }
        
        .btn-submit,
        .btn-cancel {
            flex: 1;
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-submit {
            background: var(--primary-color);
            color: white;
            border: 1px solid var(--primary-color);
        }
        
        .btn-submit:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(9, 177, 186, 0.3);
        }
        
        .btn-cancel {
            background: white;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        
        .btn-cancel:hover {
            border-color: var(--text-secondary);
            background-color: var(--light-bg);
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="pickswap-header">
        <div class="header-container">
            <a href="/pickswap" class="logo">
                <svg class="logo-svg" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- ì™¼ìª½ í™”ì‚´í‘œ -->
                    <path d="M8 16L14 10L14 13L18 13L18 10L24 16L18 22L18 19L14 19L14 22L8 16Z" fill="#09B1BA"/>
                    <!-- ì™¸ê³½ ì› -->
                    <circle cx="16" cy="16" r="14" stroke="#09B1BA" stroke-width="2" fill="none"/>
                    <!-- ì‘ì€ ì ë“¤ (ê±°ë˜ ëŠë‚Œ) -->
                    <circle cx="6" cy="16" r="1.5" fill="#13C1CA"/>
                    <circle cx="26" cy="16" r="1.5" fill="#13C1CA"/>
                </svg>
                <span class="logo-text">Pick Swap</span>
            </a>
            
            <div class="nav-actions">
                <a href="/pickswap" class="nav-btn btn-my-products">
                    â† ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="sell-container">
        <div class="sell-header">
            <h1>âœ¨ ìƒí’ˆ ë“±ë¡í•˜ê¸°</h1>
            <p>íŒë§¤í•  ìƒí’ˆì˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
        </div>
        
        <form id="sell-form" class="sell-form">
            <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
            <div class="form-section">
                <label class="form-label">
                    ìƒí’ˆ ì´ë¯¸ì§€ <span class="required">*</span>
                </label>
                <div class="image-upload" onclick="document.getElementById('image-input').click()">
                    <div class="image-upload-icon">ğŸ“·</div>
                    <div class="image-upload-text">
                        í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”<br>
                        <small>(ìµœëŒ€ 5ì¥)</small>
                    </div>
                </div>
                <input type="file" 
                       id="image-input" 
                       accept="image/*" 
                       multiple 
                       style="display: none;"
                       onchange="handleImageUpload(event)">
                <div id="image-preview" class="image-preview"></div>
            </div>
            
            <!-- ì œëª© -->
            <div class="form-section">
                <label class="form-label" for="title">
                    ì œëª© <span class="required">*</span>
                </label>
                <input type="text" 
                       id="title" 
                       class="form-input" 
                       placeholder="ìƒí’ˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                       required>
            </div>
            
            <!-- ì¹´í…Œê³ ë¦¬ & ìƒíƒœ -->
            <div class="form-section">
                <div class="form-row">
                    <div>
                        <label class="form-label" for="category">
                            ì¹´í…Œê³ ë¦¬ <span class="required">*</span>
                        </label>
                        <select id="category" class="form-select" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ELECTRONICS">ğŸ“± ì „ìê¸°ê¸°</option>
                            <option value="FASHION">ğŸ‘• íŒ¨ì…˜/ì˜ë¥˜</option>
                            <option value="HOME_APPLIANCES">ğŸ”Œ ê°€ì „ì œí’ˆ</option>
                            <option value="FURNITURE">ğŸ›‹ï¸ ê°€êµ¬/ì¸í…Œë¦¬ì–´</option>
                            <option value="BOOKS">ğŸ“š ë„ì„œ</option>
                            <option value="SPORTS">âš½ ìŠ¤í¬ì¸ /ë ˆì €</option>
                            <option value="TOYS">ğŸ® ì™„êµ¬/ì·¨ë¯¸</option>
                            <option value="BEAUTY">ğŸ’„ ë·°í‹°/ë¯¸ìš©</option>
                            <option value="PET_SUPPLIES">ğŸ¾ ë°˜ë ¤ë™ë¬¼ìš©í’ˆ</option>
                            <option value="OTHERS">ğŸ“¦ ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label" for="condition">
                            ìƒí’ˆ ìƒíƒœ <span class="required">*</span>
                        </label>
                        <select id="condition" class="form-select" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="NEW">ğŸ†• ìƒˆ ìƒí’ˆ</option>
                            <option value="LIKE_NEW">âœ¨ ê±°ì˜ ìƒˆê²ƒ</option>
                            <option value="GOOD">ğŸ‘ ì¢‹ìŒ</option>
                            <option value="FAIR">ğŸ‘Œ ë³´í†µ</option>
                            <option value="POOR">ğŸ”§ ë‚˜ì¨</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- ê°€ê²© & ìœ„ì¹˜ -->
            <div class="form-section">
                <div class="form-row">
                    <div>
                        <label class="form-label" for="price">
                            ê°€ê²© <span class="required">*</span>
                        </label>
                        <input type="number" 
                               id="price" 
                               class="form-input" 
                               placeholder="0"
                               min="0"
                               required>
                    </div>
                    <div>
                        <label class="form-label" for="location">
                            ê±°ë˜ ì§€ì—­ <span class="required">*</span>
                        </label>
                        <input type="text" 
                               id="location" 
                               class="form-input" 
                               placeholder="ì˜ˆ: ì„œìš¸ ê°•ë‚¨êµ¬"
                               required>
                    </div>
                </div>
            </div>
            
            <!-- ì„¤ëª… -->
            <div class="form-section">
                <label class="form-label" for="description">
                    ìƒí’ˆ ì„¤ëª… <span class="required">*</span>
                </label>
                <textarea id="description" 
                          class="form-textarea" 
                          placeholder="ìƒí’ˆì— ëŒ€í•´ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”"
                          required></textarea>
            </div>
            
            <!-- ì œì¶œ ë²„íŠ¼ -->
            <div class="submit-section">
                <button type="button" class="btn-cancel" onclick="history.back()">
                    ì·¨ì†Œ
                </button>
                <button type="submit" class="btn-submit">
                    âœ¨ ë“±ë¡í•˜ê¸°
                </button>
            </div>
        </form>
    </div>
    
    <script>
        let uploadedImages = [];
        
        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleImageUpload(event) {
            const files = Array.from(event.target.files);
            
            if (uploadedImages.length + files.length > 5) {
                alert('ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 5ì¥ê¹Œì§€ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImages.push(e.target.result);
                    displayImagePreview();
                };
                reader.readAsDataURL(file);
            });
        }
        
        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function displayImagePreview() {
            const preview = document.getElementById('image-preview');
            preview.innerHTML = uploadedImages.map((url, index) => `
                <div class="preview-item">
                    <img src="${url}" alt="Preview ${index + 1}" class="preview-image">
                    <button type="button" class="preview-remove" onclick="removeImage(${index})">
                        Ã—
                    </button>
                </div>
            `).join('');
        }
        
        // ì´ë¯¸ì§€ ì œê±°
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            displayImagePreview();
        }
        
        // í¼ ì œì¶œ
        document.getElementById('sell-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (uploadedImages.length === 0) {
                alert('ìµœì†Œ 1ì¥ì˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const formData = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                price: parseFloat(document.getElementById('price').value),
                category: document.getElementById('category').value,
                productCondition: document.getElementById('condition').value,
                location: document.getElementById('location').value,
                sellerId: 1, // TODO: ì‹¤ì œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ID
                sellerName: 'í…ŒìŠ¤íŠ¸ íŒë§¤ì', // TODO: ì‹¤ì œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì´ë¦„
                imageUrls: uploadedImages
            };
            
            try {
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const product = await response.json();
                    alert('ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    window.location.href = `/pickswap/products/${product.id}`;
                } else {
                    throw new Error('ìƒí’ˆ ë“±ë¡ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ìƒí’ˆ ë“±ë¡ ì‹¤íŒ¨:', error);
                alert('ìƒí’ˆ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        });
    </script>
</body>
</html>
