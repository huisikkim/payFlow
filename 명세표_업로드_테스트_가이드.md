# 📋 명세표 업로드 + 재료 매칭 테스트 가이드

## 🚀 빠른 시작

### 1. 애플리케이션 실행
```bash
./gradlew bootRun
```

### 2. 웹 페이지 접속

**재료 매칭 포함 업로드 페이지**:
```
http://localhost:8080/specification/upload-with-matching
```

**기존 명세표 업로드 페이지 (LLM 사용)**:
```
http://localhost:8080/specification/upload
```

**재료 매칭 테스트 페이지**:
```
http://localhost:8080/ingredients/matching-test
```

## 📝 테스트 방법

### 방법 1: 웹 UI에서 테스트 (추천)

1. **페이지 접속**
   ```
   http://localhost:8080/specification/upload-with-matching
   ```

2. **명세표 이미지 업로드**
   - 드래그 앤 드롭 또는 클릭해서 파일 선택
   - JPG, PNG 형식 지원

3. **결과 확인**
   - OCR 추출된 텍스트
   - 각 항목별 재료 매칭 결과
   - 매칭 성공/실패 통계
   - 성공률 표시

### 방법 2: API로 테스트

```bash
# 명세표 업로드 + 재료 매칭
curl -X POST http://localhost:8080/api/specification/upload-with-matching \
  -F "file=@/path/to/your/invoice.jpg"
```

**응답 예시**:
```json
{
  "id": 1,
  "imagePath": "invoice.jpg",
  "extractedText": "양파 10kg\n감자 20kg\n당근 15kg",
  "productName": "양파",
  "category": "재료",
  "quantity": 3,
  "status": "PARSED",
  "items": [
    {
      "itemName": "양파",
      "itemValue": "양파 10kg",
      "unit": "매칭: 100%",
      "sequence": 0
    },
    {
      "itemName": "감자",
      "itemValue": "감자 20kg",
      "unit": "매칭: 100%",
      "sequence": 1
    },
    {
      "itemName": "당근",
      "itemValue": "당근 15kg",
      "unit": "매칭: 100%",
      "sequence": 2
    }
  ]
}
```

## 🧪 테스트 시나리오

### 시나리오 1: 정확한 재료명
**명세표 내용**:
```
양파 10kg
감자 20kg
당근 15kg
```

**예상 결과**:
- ✅ 양파 → 양파 (100% 매칭)
- ✅ 감자 → 감자 (100% 매칭)
- ✅ 당근 → 당근 (100% 매칭)

### 시나리오 2: 공백 포함
**명세표 내용**:
```
양 파 10kg
감 자 20kg
당 근 15kg
```

**예상 결과**:
- ✅ 양 파 → 양파 (100% 매칭)
- ✅ 감 자 → 감자 (100% 매칭)
- ✅ 당 근 → 당근 (100% 매칭)

### 시나리오 3: 괄호 및 불용어 포함
**명세표 내용**:
```
양파(국산) 10kg
감자 냉장 20kg
당근 특상 15kg
```

**예상 결과**:
- ✅ 양파(국산) → 양파 (100% 매칭)
- ✅ 감자 냉장 → 감자 (100% 매칭)
- ✅ 당근 특상 → 당근 (100% 매칭)

### 시나리오 4: 복잡한 케이스
**명세표 내용**:
```
닭 가슴살 2kg 냉장
대파 8단 (국산)
마늘 5kg 특상
```

**예상 결과**:
- ✅ 닭 가슴살 2kg 냉장 → 닭가슴살 (100% 매칭)
- ✅ 대파 8단 (국산) → 대파 (90% 매칭)
- ✅ 마늘 5kg 특상 → 마늘 (100% 매칭)

### 시나리오 5: 유사도 매칭
**명세표 내용**:
```
양과
감자
당금
```

**예상 결과**:
- ✅ 양과 → 양파 (70% 유사도 매칭)
- ✅ 감자 → 감자 (100% 매칭)
- ⚠️ 당금 → 당근 (유사도에 따라 매칭 여부 결정)

## 📊 결과 해석

### 매칭 성공
```
✅ 매칭 성공
원본 텍스트: 양파 10kg
상태: 매칭: 100%
```
- 표준 재료명으로 정확히 매칭됨
- 재고 관리, 메뉴 레시피 등에 바로 사용 가능

### 매칭 실패
```
❌ 매칭 실패
원본 텍스트: 알 수 없는 재료
상태: 유사도 부족 (최고: 0.45 < 0.70)
```
- 동의어 사전에 없고 유사도도 낮음
- 관리자가 동의어 추가 필요

## 🔧 문제 해결

### Q: 매칭 실패가 많이 발생합니다
**A**: 동의어를 추가하세요.

1. 재료 매칭 테스트 페이지 접속:
   ```
   http://localhost:8080/ingredients/matching-test
   ```

2. "동의어 추가" 섹션에서:
   - 표준 재료명: 양파
   - 동의어: 노란양파
   - 유사도: 0.95

3. 또는 API로 추가:
   ```bash
   curl -X POST http://localhost:8080/api/ingredients/synonyms \
     -H "Content-Type: application/json" \
     -d '{
       "standardName": "양파",
       "synonym": "노란양파",
       "similarityScore": 0.95
     }'
   ```

### Q: OCR 추출이 정확하지 않습니다
**A**: 
- 이미지 품질을 높이세요 (해상도, 밝기)
- 명세표가 깨끗하고 선명한지 확인
- PaddleOCR 설정 조정 (ocr_service.py)

### Q: 특정 단위가 제거되지 않습니다
**A**: `IngredientNormalizer.java`에 단위 추가:
```java
private static final Pattern NUMBER_UNIT_PATTERN = 
    Pattern.compile("\\d+(\\.\\d+)?(kg|g|ml|l|개|봉|팩|box|단|포)?", Pattern.CASE_INSENSITIVE);
```

## 📁 테스트 이미지 준비

### 샘플 명세표 만들기

1. **텍스트 에디터로 작성**:
   ```
   양파 10kg
   감자 20kg
   당근 15kg
   대파 8단
   마늘 5kg
   ```

2. **스크린샷 찍기** 또는 **이미지로 저장**

3. **업로드 페이지에서 테스트**

### 실제 명세표 사용
- 실제 유통업체 명세표 스캔
- 휴대폰으로 촬영한 명세표
- PDF를 이미지로 변환

## 🎯 성공 기준

### 좋은 결과
- ✅ 매칭 성공률 90% 이상
- ✅ 대부분의 재료가 표준 재료명으로 변환
- ✅ 빠른 처리 속도 (< 5초)

### 개선 필요
- ⚠️ 매칭 성공률 70% 미만
- ⚠️ 많은 재료가 매칭 실패
- ⚠️ 처리 시간이 너무 오래 걸림

## 📚 관련 문서

- [전체 가이드](./INGREDIENT_MATCHING_GUIDE.md)
- [빠른 시작](./INGREDIENT_MATCHING_QUICK_START.md)
- [README](./README.md)

## 🔗 유용한 링크

- 명세표 업로드 (재료 매칭): http://localhost:8080/specification/upload-with-matching
- 재료 매칭 테스트: http://localhost:8080/ingredients/matching-test
- 명세표 목록: http://localhost:8080/specification
- API 문서: http://localhost:8080/swagger-ui.html (설정 시)

## 💡 팁

1. **이미지 품질이 중요합니다**
   - 해상도: 최소 1000x1000 픽셀
   - 밝기: 충분히 밝게
   - 선명도: 흐릿하지 않게

2. **동의어 사전을 확장하세요**
   - 자주 사용하는 재료 추가
   - 지역별 방언 추가
   - 영문명 추가

3. **정기적으로 매칭 결과를 확인하세요**
   - 실패한 케이스 분석
   - 동의어 추가
   - 유사도 임계값 조정

## 🎉 완료!

이제 명세표를 업로드하고 자동으로 재료를 매칭할 수 있습니다!

문의사항이 있으면 GitHub Issues에 등록해주세요.
